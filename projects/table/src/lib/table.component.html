<div class="card border-dark">
   <div class="card-header" *ngIf="label || filter || search || headerBtn">
      <form class="form-inline">
         <ng-container *ngIf="label">
            <b>{{ label }}</b>
         </ng-container>
         <ng-container *ngIf="filter">
            <label for="filter" class="form-label">Gyorsszűrő:</label>
            <input class="form-control" id="{{ 'filter' + id }}" type="search" placeholder="Szűrés" #filter
               (search)="onFilter(filter.value)" (keyup)="onFilter(filter.value)">
         </ng-container>
         <ng-container *ngIf="search">
            <button class="btn btn-primary" style="margin-left: 4px" (click)="onSearch()">
               <lib-icon [content]="'fas:faSearch'"> </lib-icon>
            </button>
         </ng-container>
         <ng-container *ngIf="headerBtn">
            <div class="col" style="text-align: right">
               <div style="display: inline-flex">
                  <div *ngFor="let button of headerBtn; let i = index">
                     <button class="btn btn-primary" (click)="onHeaderBtn(i)" type="button"
                        style="margin-left: 2px; margin-right: 2px" [id]="'button'+i">{{ button }}</button>
                  </div>
               </div>
            </div>
         </ng-container>
      </form>
   </div>
   <div class="card-body">
      <div class="table-responsive">
         <table class="table table-sm table-hover" [ngClass]="multiRow ? 'table-bordered' : null">
            <thead *ngIf="headers">
               <tr *ngFor="let row of headers.rows; let i = index">
                  <th *ngIf="nr && i === 0" [attr.rowspan]="headers.rows.length"
                     [ngClass]="multiRow ? 'text-center' : null">
                     {{ nr }}
                  </th>
                  <th scope="col" *ngFor="let header of row" [attr.rowspan]="header.rowspan"
                     [attr.colspan]="header.colspan"
                     [ngClass]="[multiRow ? 'text-center' : '', header.classes ? header.classes.join(' ') : '']">
                     {{ header.str ? header.str : header }}
                  </th>
                  <th *ngIf="button" scope="col">
                     {{ button[0] }}
                  </th>
               </tr>
            </thead>
            <tbody>
               <tr *ngFor="let row of rows; let i = index" (click)="onRowClick(row)"
                  [ngClass]="i === selected ? 'table-active' : null">
                  <ng-container *ngIf="getRowVisible(row)">
                     <!-- serial number of row -->
                     <th *ngIf="nr" [ngClass]="multiRow ? 'text-center' : null">
                        #{{ desc ? rows.length - i : i + 1 }}
                     </th>
                     <!-- other fields listed in the order of codes -->
                     <ng-container *ngFor="let code of codes.fields; let j = index">
                        <ng-container *ngFor="let fieldValue of [getFieldValue(row, code.field)]">
                           <td *ngIf="fieldValue !== null; else emptyCol"
                              [ngClass]="[code.classes ? code.classes.join(' ') : '', multiRow ? 'center' : '', fieldValue.classes ? fieldValue.classes.join(' ') : '']">
                              <ng-container [ngSwitch]="true">
                                 <input *ngSwitchCase="inputs && (inputs[0].includes(i) || inputs[1].includes(j))"
                                    id="{{ 'input' + i + '' + j }}" class="form-control" type="text"
                                    value="{{ fieldValue }}" (focusout)="onFocusOut($event, row, i, j)">
                                 <!-- if this field contains icons -->
                                 <lib-icon *ngSwitchCase="isIcons([fieldValue])" [content]="fieldValue.content"
                                    [tooltip]="fieldValue.tooltip"
                                    (iClicked)="onIconClick({row: row, icon: fieldValue.content, id: fieldValue.id})">
                                 </lib-icon>
                                 <!-- if this field is boolean -->
                                 <div *ngSwitchCase="isBoolean(row[code.field])" class="custom-control custom-checkbox">
                                    <input class="custom-control-input"
                                       id="{{ code.field + '_' + rows.indexOf(row) + '_' + id }}" type="checkbox"
                                       [(ngModel)]="row[code.field]"
                                       (change)="onCheckChange({row: row, elem: code.field})" [disabled]="readOnly">
                                    <label class="custom-control-label"
                                       for="{{ code.field + '_' + rows.indexOf(row) + '_' + id }}"></label>
                                 </div>
                                 <!-- if this field is a link -->
                                 <a *ngSwitchCase="isLink(fieldValue)" [routerLink]="fieldValue.link"
                                    [queryParams]="fieldValue.params">
                                    {{ fieldValue.value }}
                                 </a>
                                 <!-- default: normal text -->
                                 <ng-container *ngSwitchDefault>
                                    {{ fieldValue }}
                                 </ng-container>
                              </ng-container>
                           </td>
                           <ng-template #emptyCol>
                              <td></td>
                           </ng-template>
                        </ng-container>
                     </ng-container>
                     <td *ngIf="button && (!btnFiltCond || row[btnFiltCond]); else emptyCol">
                        <button class="btn btn-sm btn-primary" (click)="onBtnClick(row)">
                           {{ button[1] }}
                        </button>
                     </td>
                     <ng-template #emptyCol>
                        <td *ngIf="button"></td>
                     </ng-template>
                  </ng-container>
               </tr>
            </tbody>
         </table>
      </div>
   </div>
   <div class="card-footer" *ngIf="isPagination()">
      <div class="col" [ngStyle]="{'text-align': pagination.align }">
         <div style="display: inline-flex">
            <pagination [totalItems]="pagination.totalItems" [itemsPerPage]="pagination.itemsPerPage"
               [nextText]="pagination.nextText" [previousText]="pagination.previousText" [maxSize]="pagination.maxSize"
               [rotate]="pagination.rotate" [boundaryLinks]="pagination.boundaryLinks"
               [firstText]="pagination.firstText" [lastText]="pagination.lastText"
               (pageChanged)="onPageChanged($event)">
            </pagination>
         </div>
      </div>
   </div>
</div>